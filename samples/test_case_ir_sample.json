{
  "meta": {
    "id": "RQPLEIAD_180_04",
    "name": "Emergency_Outgoing_Call_By_Program_Key",
    "priority": "high",
    "tags": [
      "emergency",
      "outgoing_call",
      "program_key",
      "UI_verification",
      "call_control",
      "audio_switch",
      "call_log"
    ]
  },

  "variables": {
    "emergency_number": {
      "type": "string",
      "value": "xxxx"
    },
    "call_duration": {
      "type": "string",
      "value": "xx:xx"
    },
    "release_button_state": {
      "type": "string",
      "value": "grey"
    },
    "hold_button_state": {
      "type": "string",
      "value": "grey"
    }
  },

  "preconditions": [
    {
      "target": "phone",
      "property": "has_program_key",
      "operator": "==",
      "value": true
    },
    {
      "target": "program_key",
      "property": "type",
      "operator": "==",
      "value": "emergency"
    }
  ],

  "steps": [
    {
      "id": "step_1",
      "type": "action",
      "target": "program_key",
      "operation": "press",
      "params": {
        "key_type": "emergency",
        "press_type": "short_or_long",
        "device": "phone_or_addon"
      }
    },
    {
      "id": "step_1_check",
      "type": "check",
      "target": "screen",
      "property": "title",
      "operator": "==",
      "value": "Outgoing call"
    },
    {
      "id": "step_1_check_2",
      "type": "check",
      "target": "screen",
      "property": "background_color",
      "operator": "==",
      "value": "Red"
    },
    {
      "id": "step_1_check_3",
      "type": "check",
      "target": "emergency_avatar",
      "property": "displayed",
      "operator": "==",
      "value": true
    },
    {
      "id": "step_1_check_4",
      "type": "check",
      "target": "release_button",
      "property": "displayed",
      "operator": "==",
      "value": true
    },
    {
      "id": "step_1_check_5",
      "type": "check",
      "target": "release_button",
      "property": "led_state",
      "operator": "==",
      "value": "on"
    },

    {
      "id": "step_2",
      "type": "action",
      "target": "remote_side",
      "operation": "answer_call",
      "params": {
        "action": "answer"
      }
    },
    {
      "id": "step_2_check",
      "type": "check",
      "target": "screen",
      "property": "title",
      "operator": "matches",
      "value": "Conversation \\d+:\\d+"
    },
    {
      "id": "step_2_check_2",
      "type": "check",
      "target": "screen",
      "property": "background_color",
      "operator": "==",
      "value": "Red"
    },
    {
      "id": "step_2_check_3",
      "type": "check",
      "target": "emergency_avatar",
      "property": "led_state",
      "operator": "==",
      "value": "on"
    },
    {
      "id": "step_2_check_4",
      "type": "check",
      "target": "new_call_button",
      "property": "led_state",
      "operator": "==",
      "value": "on"
    },
    {
      "id": "step_2_check_5",
      "type": "check",
      "target": "release_button",
      "property": "led_state",
      "operator": "==",
      "value": "off"
    },
    {
      "id": "step_2_check_6",
      "type": "check",
      "target": "hold_button",
      "property": "led_state",
      "operator": "==",
      "value": "off"
    },

    {
      "id": "step_3",
      "type": "action",
      "target": "emergency_avatar",
      "operation": "press"
    },
    {
      "id": "step_3_check",
      "type": "check",
      "target": "screen",
      "property": "content",
      "operator": "contains",
      "value": "emergency info"
    },

    {
      "id": "step_4",
      "type": "action",
      "target": "new_call_button",
      "operation": "press"
    },
    {
      "id": "step_4_check",
      "type": "check",
      "target": "screen",
      "property": "type",
      "operator": "==",
      "value": "add_new_call_screen"
    },

    {
      "id": "step_5",
      "type": "action",
      "target": "hold_key",
      "operation": "press",
      "params": {
        "key_type": "screen_or_physical"
      }
    },
    {
      "id": "step_5_check",
      "type": "check",
      "target": "call",
      "property": "hold_status",
      "operator": "==",
      "value": "not_held"
    },

    {
      "id": "step_6",
      "type": "action",
      "target": "handset",
      "operation": "pick_up"
    },
    {
      "id": "step_6_check",
      "type": "check",
      "target": "audio",
      "property": "output_device",
      "operator": "==",
      "value": "handset"
    },

    {
      "id": "step_7",
      "type": "action",
      "target": "handset",
      "operation": "hang_on"
    },
    {
      "id": "step_7_check",
      "type": "check",
      "target": "audio",
      "property": "output_device",
      "operator": "==",
      "value": "handsfree"
    },

    {
      "id": "step_8",
      "type": "action",
      "target": "release_key",
      "operation": "press",
      "params": {
        "key_type": "screen_or_physical"
      }
    },
    {
      "id": "step_8_check",
      "type": "check",
      "target": "call",
      "property": "release_status",
      "operator": "==",
      "value": "not_released"
    },

    {
      "id": "step_9",
      "type": "wait",
      "target": "call",
      "condition": {
        "target": "call",
        "property": "state",
        "operator": "==",
        "value": "released"
      },
      "timeout": 5000,
      "interval": 500
    },
    {
      "id": "step_9_check",
      "type": "check",
      "target": "call_log",
      "property": "has_emergency_call",
      "operator": "==",
      "value": true
    },
    {
      "id": "step_9_check_2",
      "type": "check",
      "target": "call_log",
      "property": "call_direction",
      "operator": "==",
      "value": "outgoing"
    },
    {
      "id": "step_9_check_3",
      "type": "check",
      "target": "call_log_entry",
      "property": "label_displayed",
      "operator": "==",
      "value": true
    },
    {
      "id": "step_9_check_4",
      "type": "check",
      "target": "call_log_entry",
      "property": "avatar_displayed",
      "operator": "==",
      "value": true
    },
    {
      "id": "step_9_check_5",
      "type": "check",
      "target": "call_log_entry",
      "property": "name_displayed",
      "operator": "==",
      "value": true
    },
    {
      "id": "step_9_check_6",
      "type": "check",
      "target": "call_log_entry",
      "property": "number_displayed",
      "operator": "==",
      "value": true
    },
    {
      "id": "step_9_check_7",
      "type": "check",
      "target": "call_log_entry",
      "property": "date_displayed",
      "operator": "==",
      "value": true
    }
  ],

  "postconditions": [
    {
      "target": "call_log",
      "property": "emergency_call_recorded",
      "operator": "==",
      "value": true
    }
  ]
}